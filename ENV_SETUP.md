# ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ Docker Compose éƒ¨ç½²ï¼Œ**æ‰€æœ‰ç¯å¢ƒå˜é‡å¿…é¡»åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ä¸­é…ç½®**ã€‚

âš ï¸ **é‡è¦æç¤ºï¼š**
- `docker-compose` åªä¼šè¯»å–**æ ¹ç›®å½•**çš„ `.env` æ–‡ä»¶
- `frontend/.env` å’Œ `backend/.env` åœ¨ Docker æ„å»ºæ—¶**ä¸ä¼šè¢«ä½¿ç”¨**
- å‰ç«¯å˜é‡ï¼ˆ`VITE_*`ï¼‰åœ¨**æ„å»ºæ—¶**æ³¨å…¥ï¼Œä¿®æ”¹åéœ€è¦é‡æ–°æ„å»º
- åç«¯å˜é‡åœ¨**è¿è¡Œæ—¶**è¯»å–ï¼Œä¿®æ”¹ååªéœ€é‡å¯

## ğŸ”§ åˆ›å»º .env æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸ `docker-compose.yml` åŒçº§ï¼‰åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# =============================================================================
# AI Travel Planner - ç¯å¢ƒå˜é‡é…ç½®
# =============================================================================

# -----------------------------------------------------------------------------
# æ•°æ®åº“é…ç½®
# -----------------------------------------------------------------------------
POSTGRES_PASSWORD=123456

# -----------------------------------------------------------------------------
# åç«¯é…ç½®ï¼ˆè¿è¡Œæ—¶ç¯å¢ƒå˜é‡ï¼‰
# -----------------------------------------------------------------------------
# JWT å¯†é’¥ï¼ˆå¿…é¡»è‡³å°‘ 32 å­—èŠ‚/å­—ç¬¦ï¼Œç”¨äº JWT ç­¾åï¼‰
JWT_SECRET=ThisIsASecretKeyForJwtMustBeAtLeast32Bytes!

# JWT è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼Œé»˜è®¤ 24 å°æ—¶ = 86400000ï¼‰
JWT_EXP_MS=86400000

# é€šä¹‰åƒé—® API Keyï¼ˆç”¨äº AI è¡Œç¨‹ç”Ÿæˆï¼‰
# è·å–åœ°å€ï¼šhttps://dashscope.console.aliyun.com/
QWEN_API_KEY=sk-your-qwen-api-key-here

# åç«¯æœåŠ¡ç«¯å£ï¼ˆå¯é€‰ï¼Œé»˜è®¤ 8080ï¼‰
SERVER_PORT=8080

# -----------------------------------------------------------------------------
# å‰ç«¯é…ç½®ï¼ˆæ„å»ºæ—¶æ³¨å…¥ï¼Œéœ€è¦é‡æ–°æ„å»ºæ‰èƒ½ç”Ÿæ•ˆï¼‰
# -----------------------------------------------------------------------------
# é«˜å¾·åœ°å›¾ API Keyï¼ˆç”¨äºåœ°å›¾æ˜¾ç¤ºå’Œè·¯çº¿è§„åˆ’ï¼‰
# è·å–åœ°å€ï¼šhttps://lbs.amap.com/
# âš ï¸ æ³¨æ„ï¼šä¿®æ”¹åéœ€è¦é‡æ–°æ„å»ºå‰ç«¯é•œåƒ
VITE_AMAP_KEY=your-amap-api-key-here

# é«˜å¾·åœ°å›¾å®‰å…¨å¯†é’¥ï¼ˆå¯é€‰ï¼Œå¦‚æœå¯ç”¨äº†å®‰å…¨å¯†é’¥åŠŸèƒ½ï¼‰
# âš ï¸ æ³¨æ„ï¼šä¿®æ”¹åéœ€è¦é‡æ–°æ„å»ºå‰ç«¯é•œåƒ
VITE_AMAP_SECURITY_JS_CODE=your-amap-security-code-here

# API åŸºç¡€è·¯å¾„ï¼ˆå‰ç«¯ä½¿ç”¨ï¼Œé»˜è®¤ /apiï¼‰
# æ³¨æ„ï¼šæ­¤å˜é‡åœ¨ docker-compose.yml ä¸­å·²ç¡¬ç¼–ç ä¸º /apiï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹
# VITE_API_BASE=/api
```

## âœ… éªŒè¯é…ç½®

### PowerShell å‘½ä»¤

```powershell
# æŸ¥çœ‹å®Œæ•´é…ç½®ï¼ˆæ¨èï¼‰
docker-compose config > docker-compose-resolved.yml
notepad docker-compose-resolved.yml

# æˆ–è€…ä½¿ç”¨ Select-String è¿‡æ»¤
docker-compose config | Select-String "VITE_AMAP_KEY"
docker-compose config | Select-String "QWEN_API_KEY"
docker-compose config | Select-String "JWT_SECRET"
```

### æ£€æŸ¥å˜é‡æ˜¯å¦è¢«è¯»å–

å¦‚æœé…ç½®æ­£ç¡®ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š
- `VITE_AMAP_KEY` æ˜¾ç¤ºä½ è®¾ç½®çš„å€¼ï¼ˆä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼‰
- `QWEN_API_KEY` æ˜¾ç¤ºä½ è®¾ç½®çš„å€¼
- `JWT_SECRET` æ˜¾ç¤ºä½ è®¾ç½®çš„å€¼

## ğŸš€ åº”ç”¨é…ç½®

### 1. é¦–æ¬¡é…ç½®æˆ–ä¿®æ”¹å‰ç«¯å˜é‡

```bash
# åœæ­¢ç°æœ‰å®¹å™¨
docker-compose down

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨ï¼ˆå‰ç«¯ä¼šé‡æ–°æ„å»ºä»¥æ³¨å…¥æ–°çš„ API Keyï¼‰
docker-compose up -d --build
```

### 2. ä»…ä¿®æ”¹åç«¯å˜é‡

```bash
# åªéœ€é‡å¯åç«¯å®¹å™¨
docker-compose restart backend
```

### 3. åç«¯ Dockerfile æœ‰æ›´æ–°æ—¶ï¼ˆä¾‹å¦‚åˆ‡æ¢åŸºç¡€é•œåƒä¿®å¤ TLS é—®é¢˜ï¼‰

```bash
# åœæ­¢ç°æœ‰å®¹å™¨
docker-compose down

# é‡æ–°æ„å»ºåç«¯é•œåƒå¹¶å¯åŠ¨
docker-compose up -d --build backend
```

> å½“åç«¯åŸºç¡€é•œåƒæˆ–ä¾èµ–å‘ç”Ÿå˜æ›´ï¼ˆä¾‹å¦‚ä¸ºäº†è§£å†³ SSL æ¡æ‰‹é—®é¢˜ä» `eclipse-temurin:8-jre-alpine` åˆ‡æ¢åˆ° `eclipse-temurin:8-jre`ï¼‰æ—¶ï¼Œå¿…é¡»é‡æ–°æ„å»ºåç«¯é•œåƒä»¥åº”ç”¨æ–°ç¯å¢ƒã€‚

## ğŸ“ å˜é‡è¯´æ˜

### å‰ç«¯å˜é‡ï¼ˆæ„å»ºæ—¶æ³¨å…¥ï¼‰

| å˜é‡å | è¯´æ˜ | æ˜¯å¦å¿…å¡« | è·å–åœ°å€ |
|--------|------|----------|----------|
| `VITE_AMAP_KEY` | é«˜å¾·åœ°å›¾ API Key | âœ… å¿…å¡« | https://lbs.amap.com/ |
| `VITE_AMAP_SECURITY_JS_CODE` | é«˜å¾·åœ°å›¾å®‰å…¨å¯†é’¥ | âšª å¯é€‰ | é«˜å¾·æ§åˆ¶å° |
| `VITE_API_BASE` | API åŸºç¡€è·¯å¾„ | âšª å¯é€‰ï¼ˆé»˜è®¤ `/api`ï¼‰ | - |

### åç«¯å˜é‡ï¼ˆè¿è¡Œæ—¶è¯»å–ï¼‰

| å˜é‡å | è¯´æ˜ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ |
|--------|------|----------|--------|
| `POSTGRES_PASSWORD` | æ•°æ®åº“å¯†ç  | âšª å¯é€‰ | `123456` |
| `JWT_SECRET` | JWT ç­¾åå¯†é’¥ | âœ… å¿…å¡«ï¼ˆâ‰¥32å­—ç¬¦ï¼‰ | `ThisIsASecretKeyForJwtMustBeAtLeast32Bytes!` |
| `JWT_EXP_MS` | JWT è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ | âšª å¯é€‰ | `86400000` (24å°æ—¶) |
| `QWEN_API_KEY` | é€šä¹‰åƒé—® API Key | âšª å¯é€‰ï¼ˆAIåŠŸèƒ½éœ€è¦ï¼‰ | - |
| `SERVER_PORT` | åç«¯æœåŠ¡ç«¯å£ | âšª å¯é€‰ | `8080` |

## ğŸ” ä»£ç è¯»å–æ–¹å¼éªŒè¯

### å‰ç«¯è¯»å–æ–¹å¼ âœ…

- `import.meta.env.VITE_AMAP_KEY` - åœ¨ `MapService.ts` ä¸­ä½¿ç”¨
- `import.meta.env.VITE_AMAP_SECURITY_JS_CODE` - åœ¨ `MapService.ts` ä¸­ä½¿ç”¨
- `import.meta.env.VITE_API_BASE` - åœ¨ `axios.ts` ä¸­ä½¿ç”¨

### åç«¯è¯»å–æ–¹å¼ âœ…

- `${QWEN_API_KEY}` - åœ¨ `application.yml` ä¸­è¯»å–
- `${JWT_SECRET}` - åœ¨ `application.yml` ä¸­è¯»å–
- `${JDBC_DATABASE_URL}` - åœ¨ `application.yml` ä¸­è¯»å–
- `Application.java` ä¼šè¯»å–æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶å¹¶åŠ è½½åˆ°ç³»ç»Ÿå±æ€§

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆå‰ç«¯è¿˜æ˜¯æ˜¾ç¤º "API Key æœªé…ç½®"ï¼Ÿ

A: å‰ç«¯å˜é‡åœ¨**æ„å»ºæ—¶**æ³¨å…¥ï¼Œä¿®æ”¹ `.env` åå¿…é¡»é‡æ–°æ„å»ºï¼š
```bash
docker-compose up -d --build frontend
```

### Q: ä¸ºä»€ä¹ˆåç«¯è¿˜æ˜¯è¯»å–ä¸åˆ°ç¯å¢ƒå˜é‡ï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. `.env` æ–‡ä»¶æ˜¯å¦åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸ `docker-compose.yml` åŒçº§ï¼‰
2. å˜é‡åæ˜¯å¦æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
3. æ˜¯å¦é‡å¯äº†åç«¯å®¹å™¨ï¼š`docker-compose restart backend`

### Q: å¦‚ä½•ç¡®è®¤ docker-compose è¯»å–åˆ°äº† .env æ–‡ä»¶ï¼Ÿ

A: è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è§£æåçš„é…ç½®ï¼š
```powershell
docker-compose config > docker-compose-resolved.yml
```
ç„¶åæ‰“å¼€ `docker-compose-resolved.yml` æ–‡ä»¶ï¼Œæ£€æŸ¥å˜é‡æ˜¯å¦è¢«æ­£ç¡®æ›¿æ¢ã€‚

